import requests
import json
from connectors.core.connector import get_logger, ConnectorError
from .constants import LOGGER_NAME

logger = get_logger(LOGGER_NAME)


def invoke_rest_endpoint(config, endpoint, method='GET', data=None, headers=None):
    if headers is None:
        headers = {'accept': 'application/json'}
    # utility function for a sample rest based integration using basic authentication
    # change as required for the specific integration being built
    server_url = config.get('server_url')
    protocol = 'http'
    url = '{0}://{1}/api{2}'.format(protocol.lower(), server_url, endpoint)
    try:
        response = requests.request(method, url, data=json.dumps(data), headers=headers)
        return response.json()
    except Exception as e:
        logger.exception('Error invoking endpoint: {0}'.format(url))
        raise ConnectorError('Error: {0}'.format(str(e)))
